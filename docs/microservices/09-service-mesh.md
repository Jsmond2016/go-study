---
title: æœåŠ¡ç½‘æ ¼
difficulty: advanced
duration: "6-8å°æ—¶"
prerequisites: ["å¾®æœåŠ¡æ¶æ„", "Kubernetes", "å®¹å™¨åŒ–"]
tags: ["æœåŠ¡ç½‘æ ¼", "Istio", "æµé‡ç®¡ç†", "å¯è§‚æµ‹æ€§", "å®‰å…¨"]
---

# æœåŠ¡ç½‘æ ¼

æœåŠ¡ç½‘æ ¼æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„åŸºç¡€è®¾æ–½å±‚ï¼Œå®ƒå¤„ç†æœåŠ¡ä¹‹é—´çš„é€šä¿¡ï¼Œæä¾›æµé‡ç®¡ç†ã€å®‰å…¨ã€å¯è§‚æµ‹æ€§ç­‰åŠŸèƒ½ã€‚

## ğŸ“‹ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬æ•™ç¨‹åï¼Œä½ å°†èƒ½å¤Ÿï¼š

- [ ] ç†è§£æœåŠ¡ç½‘æ ¼çš„æ¦‚å¿µå’Œæ¶æ„
- [ ] äº†è§£ Istio æœåŠ¡ç½‘æ ¼
- [ ] å®ç°æµé‡ç®¡ç†ï¼ˆè·¯ç”±ã€è´Ÿè½½å‡è¡¡ï¼‰
- [ ] å®ç°å®‰å…¨ç­–ç•¥ï¼ˆmTLSã€è®¤è¯ï¼‰
- [ ] å®ç°å¯è§‚æµ‹æ€§ï¼ˆè¿½è¸ªã€æŒ‡æ ‡ã€æ—¥å¿—ï¼‰
- [ ] éƒ¨ç½²å’Œç®¡ç†æœåŠ¡ç½‘æ ¼

## ğŸ¯ æœåŠ¡ç½‘æ ¼ç®€ä»‹

### ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼

æœåŠ¡ç½‘æ ¼æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„åŸºç¡€è®¾æ–½å±‚ï¼Œå®ƒå¤„ç†æœåŠ¡ä¹‹é—´çš„é€šä¿¡ï¼Œæä¾›ï¼š

- **æµé‡ç®¡ç†**ï¼šè·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­
- **å®‰å…¨**ï¼šmTLSã€è®¤è¯ã€æˆæƒ
- **å¯è§‚æµ‹æ€§**ï¼šè¿½è¸ªã€æŒ‡æ ‡ã€æ—¥å¿—
- **ç­–ç•¥**ï¼šé™æµã€é‡è¯•ã€è¶…æ—¶

### æœåŠ¡ç½‘æ ¼æ¶æ„

```
åº”ç”¨æœåŠ¡ â†’ Sidecar ä»£ç† â†’ æœåŠ¡ç½‘æ ¼æ§åˆ¶å¹³é¢
    â†“            â†“              â†“
ä¸šåŠ¡é€»è¾‘    æµé‡ç®¡ç†        é…ç½®ç®¡ç†
```

### ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç½‘æ ¼

**ä¼˜åŠ¿**ï¼š

1. **è§£è€¦**ï¼šä¸šåŠ¡ä»£ç ä¸åŸºç¡€è®¾æ–½è§£è€¦
2. **ç»Ÿä¸€**ï¼šç»Ÿä¸€çš„æœåŠ¡é—´é€šä¿¡
3. **å¯è§‚æµ‹**ï¼šè‡ªåŠ¨æ”¶é›†æŒ‡æ ‡å’Œè¿½è¸ª
4. **å®‰å…¨**ï¼šè‡ªåŠ¨ mTLS åŠ å¯†
5. **ç­–ç•¥**ï¼šç»Ÿä¸€çš„ç­–ç•¥ç®¡ç†

## ğŸ”§ Istio æœåŠ¡ç½‘æ ¼

### ä»€ä¹ˆæ˜¯ Istio

Istio æ˜¯ Googleã€IBM å’Œ Lyft å¼€æºçš„æœåŠ¡ç½‘æ ¼ï¼Œæä¾›ï¼š

- æµé‡ç®¡ç†
- å®‰å…¨ç­–ç•¥
- å¯è§‚æµ‹æ€§
- ç­–ç•¥æ‰§è¡Œ

### å®‰è£… Istio

```bash
# ä¸‹è½½ Istio
curl -L https://istio.io/downloadIstio | sh -
cd istio-*

# å®‰è£… Istio
istioctl install --set profile=demo -y

# å¯ç”¨è‡ªåŠ¨æ³¨å…¥
kubectl label namespace default istio-injection=enabled
```

### æµé‡ç®¡ç†

#### 1. è™šæ‹ŸæœåŠ¡ï¼ˆVirtualServiceï¼‰

```yaml
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: reviews
spec:
  hosts:
  - reviews
  http:
  - match:
    - headers:
        end-user:
          exact: jason
    route:
    - destination:
        host: reviews
        subset: v2
  - route:
    - destination:
        host: reviews
        subset: v1
```

#### 2. ç›®æ ‡è§„åˆ™ï¼ˆDestinationRuleï¼‰

```yaml
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: reviews
spec:
  host: reviews
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
```

### å®‰å…¨ç­–ç•¥

#### 1. å¯ç”¨ mTLS

```yaml
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
spec:
  mtls:
    mode: STRICT
```

#### 2. æˆæƒç­–ç•¥

```yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: httpbin-policy
spec:
  selector:
    matchLabels:
      app: httpbin
  action: ALLOW
  rules:
  - from:
    - source:
        principals: ["cluster.local/ns/default/sa/sleep"]
```

### å¯è§‚æµ‹æ€§

Istio è‡ªåŠ¨æä¾›ï¼š

- **è¿½è¸ª**ï¼šåˆ†å¸ƒå¼è¿½è¸ªï¼ˆJaegerï¼‰
- **æŒ‡æ ‡**ï¼šPrometheus æŒ‡æ ‡
- **æ—¥å¿—**ï¼šè®¿é—®æ—¥å¿—

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ¸è¿›å¼é‡‡ç”¨

- ä»å•ä¸ªæœåŠ¡å¼€å§‹
- é€æ­¥æ‰©å±•åˆ°æ‰€æœ‰æœåŠ¡
- ç›‘æ§æ€§èƒ½å½±å“

### 2. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ Sidecar ä»£ç†
- ä¼˜åŒ–èµ„æºé™åˆ¶
- ç›‘æ§å»¶è¿Ÿ

### 3. å®‰å…¨é…ç½®

- å¯ç”¨ mTLS
- é…ç½®æˆæƒç­–ç•¥
- å®šæœŸæ›´æ–°

## ğŸš€ æ€»ç»“

æœåŠ¡ç½‘æ ¼æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„é‡è¦åŸºç¡€è®¾æ–½ï¼Œé€šè¿‡ Istioï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

1. **ç»Ÿä¸€ç®¡ç†**ï¼šç»Ÿä¸€çš„æœåŠ¡é—´é€šä¿¡
2. **å¢å¼ºå®‰å…¨**ï¼šè‡ªåŠ¨ mTLS å’Œæˆæƒ
3. **æå‡å¯è§‚æµ‹æ€§**ï¼šè‡ªåŠ¨æ”¶é›†æŒ‡æ ‡å’Œè¿½è¸ª
4. **ç®€åŒ–è¿ç»´**ï¼šé›†ä¸­ç®¡ç†ç­–ç•¥

## ğŸ“š æ‰©å±•é˜…è¯»

- [Istio å®˜æ–¹æ–‡æ¡£](https://istio.io/latest/docs/)
- [æœåŠ¡ç½‘æ ¼æœ€ä½³å®è·µ](https://istio.io/latest/docs/ops/best-practices/)

## â­ï¸ ä¸‹ä¸€æ­¥

å®Œæˆå¾®æœåŠ¡å­¦ä¹ åï¼Œå¯ä»¥è¿›å…¥ï¼š
- [è¿ç»´éƒ¨ç½²](../devops/) - å®¹å™¨åŒ–å’Œéƒ¨ç½²
- [å®æˆ˜é¡¹ç›®](../projects/) - å®Œæ•´é¡¹ç›®å¼€å‘

---

**ğŸ‰ æ­å–œï¼** ä½ å·²ç»æŒæ¡äº†æœåŠ¡ç½‘æ ¼çš„åŸºç¡€çŸ¥è¯†ã€‚ç»§ç»­å­¦ä¹ ï¼Œæ„å»ºæ›´å¼ºå¤§çš„å¾®æœåŠ¡ç³»ç»Ÿï¼

