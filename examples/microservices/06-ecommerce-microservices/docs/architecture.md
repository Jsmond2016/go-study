# 系统架构文档

## 架构概述

本系统采用微服务架构，包含以下核心组件：

1. **用户服务** (User Service)
2. **订单服务** (Order Service)
3. **商品服务** (Product Service)
4. **API 网关** (API Gateway)
5. **服务发现** (Consul)

## 架构图

```
┌─────────────┐
│   Client    │
└──────┬──────┘
       │ HTTP
       │
┌──────▼──────────┐
│   API Gateway   │
│   (Port 8080)   │
└──────┬──────────┘
       │
       ├──────────────┬──────────────┐
       │              │              │
       │ gRPC         │ gRPC         │ gRPC
       │              │              │
┌──────▼──────┐ ┌─────▼──────┐ ┌─────▼──────┐
│   User      │ │   Order    │ │  Product   │
│  Service    │ │  Service   │ │  Service   │
│ (Port 5001) │ │(Port 5002) │ │(Port 5003) │
└──────┬──────┘ └─────┬──────┘ └────────────┘
       │              │
       │              │ gRPC (调用用户服务)
       │              │
       └──────────────┘
              │
              │ 服务注册/发现
              │
       ┌──────▼──────┐
       │   Consul    │
       │ (Port 8500) │
       └─────────────┘
```

## 服务职责

### 用户服务
- 用户注册和登录
- 用户信息管理
- 用户认证和验证

### 订单服务
- 订单创建和管理
- 订单状态跟踪
- 调用用户服务验证用户

### 商品服务
- 商品信息管理
- 商品库存管理
- 商品搜索和列表

### API 网关
- 统一 API 入口
- 路由转发
- 协议转换 (HTTP -> gRPC)
- 服务发现集成

## 技术栈

- **gRPC**: 服务间通信
- **Consul**: 服务发现和注册
- **SQLite**: 数据存储（示例）
- **Gin**: HTTP 框架（网关）
- **Protocol Buffers**: 接口定义

## 数据流

### 创建订单流程

1. 客户端发送 HTTP 请求到 API 网关
2. 网关通过 Consul 发现订单服务
3. 网关将 HTTP 请求转换为 gRPC 请求
4. 订单服务接收请求
5. 订单服务通过 Consul 发现用户服务
6. 订单服务调用用户服务验证用户
7. 订单服务创建订单
8. 响应返回给客户端

## 扩展性

- 每个服务可以独立扩展
- 支持多实例部署
- 通过 Consul 实现负载均衡
- 服务间解耦，易于维护

