import{_ as a,c as i,o as n,ag as l}from"./chunks/framework.mZxFZN4m.js";const o=JSON.parse('{"title":"架构设计","description":"","frontmatter":{"title":"架构设计","difficulty":"advanced","duration":"2-3小时","prerequisites":["环境搭建"],"tags":["架构","设计","微服务","系统设计"]},"headers":[],"relativePath":"microservices/ecommerce-microservices/02-architecture.md","filePath":"microservices/ecommerce-microservices/02-architecture.md","lastUpdated":1763894702000}'),e={name:"microservices/ecommerce-microservices/02-architecture.md"};function p(r,s,t,h,k,c){return n(),i("div",null,[...s[0]||(s[0]=[l(`<h1 id="架构设计" tabindex="-1">架构设计 <a class="header-anchor" href="#架构设计" aria-label="Permalink to &quot;架构设计&quot;">​</a></h1><p>本章节将详细介绍电商微服务系统的架构设计，包括服务划分、通信方式、数据存储和部署方案。</p><h2 id="📋-学习目标" tabindex="-1">📋 学习目标 <a class="header-anchor" href="#📋-学习目标" aria-label="Permalink to &quot;📋 学习目标&quot;">​</a></h2><p>完成本章节后，你将能够：</p><ul class="contains-task-list"><li class="task-list-item enabled"><input class="task-list-item-checkbox" type="checkbox"> 理解微服务架构的设计原则</li><li class="task-list-item enabled"><input class="task-list-item-checkbox" type="checkbox"> 掌握服务边界划分方法</li><li class="task-list-item enabled"><input class="task-list-item-checkbox" type="checkbox"> 设计服务间通信协议</li><li class="task-list-item enabled"><input class="task-list-item-checkbox" type="checkbox"> 规划数据存储方案</li><li class="task-list-item enabled"><input class="task-list-item-checkbox" type="checkbox"> 设计部署和运维方案</li></ul><h2 id="🏗️-系统架构" tabindex="-1">🏗️ 系统架构 <a class="header-anchor" href="#🏗️-系统架构" aria-label="Permalink to &quot;🏗️ 系统架构&quot;">​</a></h2><h3 id="整体架构图" tabindex="-1">整体架构图 <a class="header-anchor" href="#整体架构图" aria-label="Permalink to &quot;整体架构图&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                     客户端层                              │</span></span>
<span class="line"><span>│              (Web/Mobile/API Client)                     │</span></span>
<span class="line"><span>└──────────────────────┬──────────────────────────────────┘</span></span>
<span class="line"><span>                       │ HTTP</span></span>
<span class="line"><span>                       │</span></span>
<span class="line"><span>┌──────────────────────▼──────────────────────────────────┐</span></span>
<span class="line"><span>│                    API 网关层                            │</span></span>
<span class="line"><span>│  ┌──────────────────────────────────────────────────┐  │</span></span>
<span class="line"><span>│  │  API Gateway (Port 8080)                        │  │</span></span>
<span class="line"><span>│  │  - 路由转发                                       │  │</span></span>
<span class="line"><span>│  │  - 协议转换 (HTTP → gRPC)                        │  │</span></span>
<span class="line"><span>│  │  - 认证授权                                       │  │</span></span>
<span class="line"><span>│  │  - 限流熔断                                       │  │</span></span>
<span class="line"><span>│  └──────────────────────────────────────────────────┘  │</span></span>
<span class="line"><span>└──────────────────────┬──────────────────────────────────┘</span></span>
<span class="line"><span>                       │ gRPC</span></span>
<span class="line"><span>        ┌──────────────┼──────────────┐</span></span>
<span class="line"><span>        │              │              │</span></span>
<span class="line"><span>┌───────▼──────┐ ┌─────▼──────┐ ┌─────▼──────┐</span></span>
<span class="line"><span>│  用户服务     │ │  订单服务   │ │  商品服务   │</span></span>
<span class="line"><span>│ (Port 5001)  │ │ (Port 5002) │ │ (Port 5003) │</span></span>
<span class="line"><span>│              │ │             │ │             │</span></span>
<span class="line"><span>│ - 用户注册    │ │ - 订单创建   │ │ - 商品管理   │</span></span>
<span class="line"><span>│ - 用户登录    │ │ - 订单查询   │ │ - 库存管理   │</span></span>
<span class="line"><span>│ - 用户信息    │ │ - 状态更新   │ │ - 商品查询   │</span></span>
<span class="line"><span>│ - 用户验证    │ │             │ │             │</span></span>
<span class="line"><span>└───────┬──────┘ └─────┬──────┘ └─────────────┘</span></span>
<span class="line"><span>        │              │</span></span>
<span class="line"><span>        │              │ gRPC (调用用户服务)</span></span>
<span class="line"><span>        │              │</span></span>
<span class="line"><span>        └──────────────┘</span></span>
<span class="line"><span>              │</span></span>
<span class="line"><span>              │ 服务注册/发现</span></span>
<span class="line"><span>              │</span></span>
<span class="line"><span>       ┌──────▼──────┐</span></span>
<span class="line"><span>       │   Consul    │</span></span>
<span class="line"><span>       │ (Port 8500) │</span></span>
<span class="line"><span>       │             │</span></span>
<span class="line"><span>       │ - 服务注册   │</span></span>
<span class="line"><span>       │ - 服务发现   │</span></span>
<span class="line"><span>       │ - 健康检查   │</span></span>
<span class="line"><span>       └─────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h2 id="🎯-服务划分" tabindex="-1">🎯 服务划分 <a class="header-anchor" href="#🎯-服务划分" aria-label="Permalink to &quot;🎯 服务划分&quot;">​</a></h2><h3 id="服务边界原则" tabindex="-1">服务边界原则 <a class="header-anchor" href="#服务边界原则" aria-label="Permalink to &quot;服务边界原则&quot;">​</a></h3><ol><li><strong>业务边界</strong>: 按业务领域划分服务</li><li><strong>数据边界</strong>: 每个服务拥有独立的数据存储</li><li><strong>团队边界</strong>: 服务可以由不同团队独立开发</li><li><strong>技术边界</strong>: 服务可以使用不同的技术栈</li></ol><h3 id="服务职责" tabindex="-1">服务职责 <a class="header-anchor" href="#服务职责" aria-label="Permalink to &quot;服务职责&quot;">​</a></h3><h4 id="_1-用户服务-user-service" tabindex="-1">1. 用户服务 (User Service) <a class="header-anchor" href="#_1-用户服务-user-service" aria-label="Permalink to &quot;1. 用户服务 (User Service)&quot;">​</a></h4><p><strong>职责</strong>:</p><ul><li>用户注册和登录</li><li>用户信息管理</li><li>用户认证和验证</li><li>用户权限管理</li></ul><p><strong>数据</strong>:</p><ul><li>用户基本信息</li><li>用户认证信息</li><li>用户配置信息</li></ul><p><strong>接口</strong>:</p><ul><li><code>CreateUser</code>: 创建用户</li><li><code>GetUser</code>: 获取用户信息</li><li><code>UpdateUser</code>: 更新用户信息</li><li><code>DeleteUser</code>: 删除用户</li><li><code>ValidateUser</code>: 验证用户</li><li><code>Login</code>: 用户登录</li></ul><h4 id="_2-商品服务-product-service" tabindex="-1">2. 商品服务 (Product Service) <a class="header-anchor" href="#_2-商品服务-product-service" aria-label="Permalink to &quot;2. 商品服务 (Product Service)&quot;">​</a></h4><p><strong>职责</strong>:</p><ul><li>商品信息管理</li><li>商品库存管理</li><li>商品分类管理</li><li>商品搜索</li></ul><p><strong>数据</strong>:</p><ul><li>商品基本信息</li><li>商品库存信息</li><li>商品分类信息</li></ul><p><strong>接口</strong>:</p><ul><li><code>CreateProduct</code>: 创建商品</li><li><code>GetProduct</code>: 获取商品信息</li><li><code>UpdateProduct</code>: 更新商品信息</li><li><code>DeleteProduct</code>: 删除商品</li><li><code>ListProducts</code>: 获取商品列表</li><li><code>UpdateStock</code>: 更新库存</li><li><code>CheckStock</code>: 检查库存</li></ul><h4 id="_3-订单服务-order-service" tabindex="-1">3. 订单服务 (Order Service) <a class="header-anchor" href="#_3-订单服务-order-service" aria-label="Permalink to &quot;3. 订单服务 (Order Service)&quot;">​</a></h4><p><strong>职责</strong>:</p><ul><li>订单创建和管理</li><li>订单状态跟踪</li><li>订单查询</li><li>订单统计</li></ul><p><strong>数据</strong>:</p><ul><li>订单基本信息</li><li>订单项信息</li><li>订单状态信息</li></ul><p><strong>依赖</strong>:</p><ul><li>调用用户服务验证用户</li><li>调用商品服务检查库存（可选）</li></ul><p><strong>接口</strong>:</p><ul><li><code>CreateOrder</code>: 创建订单</li><li><code>GetOrder</code>: 获取订单信息</li><li><code>GetUserOrders</code>: 获取用户订单列表</li><li><code>UpdateOrderStatus</code>: 更新订单状态</li><li><code>CancelOrder</code>: 取消订单</li></ul><h4 id="_4-api-网关-api-gateway" tabindex="-1">4. API 网关 (API Gateway) <a class="header-anchor" href="#_4-api-网关-api-gateway" aria-label="Permalink to &quot;4. API 网关 (API Gateway)&quot;">​</a></h4><p><strong>职责</strong>:</p><ul><li>统一 API 入口</li><li>路由转发</li><li>协议转换 (HTTP → gRPC)</li><li>认证和授权</li><li>限流和熔断</li><li>请求日志和监控</li></ul><p><strong>特点</strong>:</p><ul><li>无状态服务</li><li>可水平扩展</li><li>不存储业务数据</li></ul><h2 id="🔌-服务间通信" tabindex="-1">🔌 服务间通信 <a class="header-anchor" href="#🔌-服务间通信" aria-label="Permalink to &quot;🔌 服务间通信&quot;">​</a></h2><h3 id="通信方式" tabindex="-1">通信方式 <a class="header-anchor" href="#通信方式" aria-label="Permalink to &quot;通信方式&quot;">​</a></h3><h4 id="_1-grpc-同步调用" tabindex="-1">1. gRPC 同步调用 <a class="header-anchor" href="#_1-grpc-同步调用" aria-label="Permalink to &quot;1. gRPC 同步调用&quot;">​</a></h4><p><strong>使用场景</strong>:</p><ul><li>需要立即响应的操作</li><li>服务间数据查询</li><li>服务间数据验证</li></ul><p><strong>示例</strong>:</p><div class="language-go vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 订单服务调用用户服务验证用户</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">userClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ValidateUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">userpb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ValidateUserRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    UserId: order.UserId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_2-服务发现" tabindex="-1">2. 服务发现 <a class="header-anchor" href="#_2-服务发现" aria-label="Permalink to &quot;2. 服务发现&quot;">​</a></h4><p><strong>使用 Consul</strong>:</p><ul><li>服务自动注册</li><li>服务自动发现</li><li>健康检查</li><li>负载均衡</li></ul><p><strong>流程</strong>:</p><ol><li>服务启动时注册到 Consul</li><li>服务调用时从 Consul 发现目标服务</li><li>使用 gRPC 客户端连接服务</li><li>定期健康检查</li></ol><h3 id="通信协议" tabindex="-1">通信协议 <a class="header-anchor" href="#通信协议" aria-label="Permalink to &quot;通信协议&quot;">​</a></h3><h4 id="protocol-buffers-定义" tabindex="-1">Protocol Buffers 定义 <a class="header-anchor" href="#protocol-buffers-定义" aria-label="Permalink to &quot;Protocol Buffers 定义&quot;">​</a></h4><div class="language-protobuf vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">protobuf</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// user.proto</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">service</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  rpc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GetUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetUserRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">returns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UserResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  rpc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ValidateUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ValidateUserRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">returns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ValidateUserResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// order.proto</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">service</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OrderService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  rpc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CreateOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CreateOrderRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">returns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OrderResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="💾-数据存储" tabindex="-1">💾 数据存储 <a class="header-anchor" href="#💾-数据存储" aria-label="Permalink to &quot;💾 数据存储&quot;">​</a></h2><h3 id="存储方案" tabindex="-1">存储方案 <a class="header-anchor" href="#存储方案" aria-label="Permalink to &quot;存储方案&quot;">​</a></h3><h4 id="_1-数据隔离" tabindex="-1">1. 数据隔离 <a class="header-anchor" href="#_1-数据隔离" aria-label="Permalink to &quot;1. 数据隔离&quot;">​</a></h4><p>每个服务拥有独立的数据存储：</p><ul><li><strong>用户服务</strong>: <code>user_service.db</code></li><li><strong>订单服务</strong>: <code>order_service.db</code></li><li><strong>商品服务</strong>: <code>product_service.db</code></li></ul><h4 id="_2-数据库选择" tabindex="-1">2. 数据库选择 <a class="header-anchor" href="#_2-数据库选择" aria-label="Permalink to &quot;2. 数据库选择&quot;">​</a></h4><p><strong>开发环境</strong>: SQLite（简单、快速）</p><p><strong>生产环境</strong>:</p><ul><li>PostgreSQL（推荐）</li><li>MySQL</li><li>MongoDB（文档存储）</li></ul><h4 id="_3-数据一致性" tabindex="-1">3. 数据一致性 <a class="header-anchor" href="#_3-数据一致性" aria-label="Permalink to &quot;3. 数据一致性&quot;">​</a></h4><p><strong>最终一致性</strong>:</p><ul><li>服务间通过事件或消息队列同步</li><li>允许短暂的数据不一致</li></ul><p><strong>强一致性</strong>:</p><ul><li>使用分布式事务（2PC、Saga）</li><li>性能开销较大</li></ul><h3 id="数据模型" tabindex="-1">数据模型 <a class="header-anchor" href="#数据模型" aria-label="Permalink to &quot;数据模型&quot;">​</a></h3><h4 id="用户服务数据模型" tabindex="-1">用户服务数据模型 <a class="header-anchor" href="#用户服务数据模型" aria-label="Permalink to &quot;用户服务数据模型&quot;">​</a></h4><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INTEGER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTOINCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    username </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TEXT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> UNIQUE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    email </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TEXT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> UNIQUE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    password</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TEXT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    full_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TEXT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DATETIME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    updated_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DATETIME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="订单服务数据模型" tabindex="-1">订单服务数据模型 <a class="header-anchor" href="#订单服务数据模型" aria-label="Permalink to &quot;订单服务数据模型&quot;">​</a></h4><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> orders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INTEGER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTOINCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INTEGER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    items </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TEXT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- JSON 格式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    total_amount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TEXT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;pending&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    shipping_address </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TEXT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DATETIME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    updated_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DATETIME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="商品服务数据模型" tabindex="-1">商品服务数据模型 <a class="header-anchor" href="#商品服务数据模型" aria-label="Permalink to &quot;商品服务数据模型&quot;">​</a></h4><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> products</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INTEGER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTOINCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TEXT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TEXT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    price </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    stock </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INTEGER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    category </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TEXT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DATETIME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    updated_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DATETIME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="🚀-部署方案" tabindex="-1">🚀 部署方案 <a class="header-anchor" href="#🚀-部署方案" aria-label="Permalink to &quot;🚀 部署方案&quot;">​</a></h2><h3 id="部署架构" tabindex="-1">部署架构 <a class="header-anchor" href="#部署架构" aria-label="Permalink to &quot;部署架构&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────┐</span></span>
<span class="line"><span>│         Docker Compose / K8s            │</span></span>
<span class="line"><span>│                                         │</span></span>
<span class="line"><span>│  ┌──────────┐  ┌──────────┐          │</span></span>
<span class="line"><span>│  │ Consul    │  │ Gateway  │          │</span></span>
<span class="line"><span>│  │ (1实例)   │  │ (多实例)  │          │</span></span>
<span class="line"><span>│  └──────────┘  └──────────┘          │</span></span>
<span class="line"><span>│                                         │</span></span>
<span class="line"><span>│  ┌──────────┐  ┌──────────┐          │</span></span>
<span class="line"><span>│  │ User      │  │ Order    │          │</span></span>
<span class="line"><span>│  │ (多实例)  │  │ (多实例)  │          │</span></span>
<span class="line"><span>│  └──────────┘  └──────────┘          │</span></span>
<span class="line"><span>│                                         │</span></span>
<span class="line"><span>│  ┌──────────┐                         │</span></span>
<span class="line"><span>│  │ Product  │                         │</span></span>
<span class="line"><span>│  │ (多实例)  │                         │</span></span>
<span class="line"><span>│  └──────────┘                         │</span></span>
<span class="line"><span>└─────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="扩展策略" tabindex="-1">扩展策略 <a class="header-anchor" href="#扩展策略" aria-label="Permalink to &quot;扩展策略&quot;">​</a></h3><ol><li><strong>水平扩展</strong>: 每个服务可以运行多个实例</li><li><strong>负载均衡</strong>: 通过 Consul 实现客户端负载均衡</li><li><strong>服务隔离</strong>: 每个服务独立部署和扩展</li></ol><h2 id="🔒-安全设计" tabindex="-1">🔒 安全设计 <a class="header-anchor" href="#🔒-安全设计" aria-label="Permalink to &quot;🔒 安全设计&quot;">​</a></h2><h3 id="认证和授权" tabindex="-1">认证和授权 <a class="header-anchor" href="#认证和授权" aria-label="Permalink to &quot;认证和授权&quot;">​</a></h3><ol><li><strong>JWT Token</strong>: 用户登录后获取 Token</li><li><strong>Token 验证</strong>: 网关验证 Token</li><li><strong>服务间认证</strong>: 使用服务密钥或 mTLS</li></ol><h3 id="数据安全" tabindex="-1">数据安全 <a class="header-anchor" href="#数据安全" aria-label="Permalink to &quot;数据安全&quot;">​</a></h3><ol><li><strong>密码加密</strong>: 使用 bcrypt 加密密码</li><li><strong>敏感数据</strong>: 不传输敏感信息</li><li><strong>HTTPS</strong>: 生产环境使用 HTTPS</li></ol><h2 id="📊-监控和日志" tabindex="-1">📊 监控和日志 <a class="header-anchor" href="#📊-监控和日志" aria-label="Permalink to &quot;📊 监控和日志&quot;">​</a></h2><h3 id="监控指标" tabindex="-1">监控指标 <a class="header-anchor" href="#监控指标" aria-label="Permalink to &quot;监控指标&quot;">​</a></h3><ol><li><strong>服务指标</strong>: 请求数、响应时间、错误率</li><li><strong>系统指标</strong>: CPU、内存、网络</li><li><strong>业务指标</strong>: 订单数、用户数、商品数</li></ol><h3 id="日志收集" tabindex="-1">日志收集 <a class="header-anchor" href="#日志收集" aria-label="Permalink to &quot;日志收集&quot;">​</a></h3><ol><li><strong>集中式日志</strong>: 使用 ELK 或 Loki</li><li><strong>日志格式</strong>: 结构化日志（JSON）</li><li><strong>日志级别</strong>: DEBUG、INFO、WARN、ERROR</li></ol><h2 id="🎯-最佳实践" tabindex="-1">🎯 最佳实践 <a class="header-anchor" href="#🎯-最佳实践" aria-label="Permalink to &quot;🎯 最佳实践&quot;">​</a></h2><h3 id="_1-服务设计" tabindex="-1">1. 服务设计 <a class="header-anchor" href="#_1-服务设计" aria-label="Permalink to &quot;1. 服务设计&quot;">​</a></h3><ul><li>✅ 单一职责原则</li><li>✅ 高内聚低耦合</li><li>✅ 无状态服务</li><li>✅ 版本管理</li></ul><h3 id="_2-通信设计" tabindex="-1">2. 通信设计 <a class="header-anchor" href="#_2-通信设计" aria-label="Permalink to &quot;2. 通信设计&quot;">​</a></h3><ul><li>✅ 异步优先</li><li>✅ 超时设置</li><li>✅ 重试机制</li><li>✅ 熔断保护</li></ul><h3 id="_3-数据设计" tabindex="-1">3. 数据设计 <a class="header-anchor" href="#_3-数据设计" aria-label="Permalink to &quot;3. 数据设计&quot;">​</a></h3><ul><li>✅ 数据隔离</li><li>✅ 最终一致性</li><li>✅ 缓存策略</li><li>✅ 数据备份</li></ul><h2 id="📚-下一步" tabindex="-1">📚 下一步 <a class="header-anchor" href="#📚-下一步" aria-label="Permalink to &quot;📚 下一步&quot;">​</a></h2><p>架构设计完成后，可以开始实现各个服务：</p><ol><li><a href="./03-user-service.html">用户服务</a> - 实现用户服务</li><li><a href="./04-product-service.html">商品服务</a> - 实现商品服务</li><li><a href="./05-order-service.html">订单服务</a> - 实现订单服务</li></ol><hr><p><strong>✅ 架构设计完成！</strong> 现在可以开始实现各个微服务了。</p>`,103)])])}const b=a(e,[["render",p]]);export{o as __pageData,b as default};
